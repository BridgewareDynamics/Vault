---
name: Fix package-lock.json consistency
overview: Implement comprehensive fixes to ensure package-lock.json remains consistent across developers and environments by adding Node.js/npm version enforcement, npm configuration, version management files, and updating documentation to use npm ci.
todos:
  - id: add-engines-field
    content: Add engines field to package.json specifying Node.js >=20.0.0 <21.0.0 and npm >=9.0.0
    status: completed
  - id: create-npmrc
    content: Create .npmrc file with lock file enforcement and consistent dependency resolution settings
    status: completed
  - id: create-nvmrc
    content: Create .nvmrc file specifying Node.js 20.x version for nvm users
    status: completed
  - id: update-readme
    content: Update README.md to use 'npm ci' instead of 'npm install' and add Node.js version management section
    status: completed
  - id: update-contributing
    content: Update CONTRIBUTING.md to use 'npm ci' instead of 'npm install' in installation instructions
    status: completed
---

#Fix package-lock.json Consistency Issues

## Problem Summary

`package-lock.json` shows as modified after `npm install` or builds, even when no dependencies change, causing unnecessary git diffs and merge conflicts.

## Root Causes Identified

1. No Node.js/npm version enforcement in `package.json`
2. Missing `.npmrc` configuration file
3. Documentation uses `npm install` instead of `npm ci`
4. No `.nvmrc` for Node version management
5. OS-specific path format differences

## Solution Overview

### 1. Add Node.js and npm Version Constraints

**File**: [package.json](package.json)

- Add `engines` field to specify required Node.js and npm versions
- Based on README requirements: Node.js 20.x, npm 9.x+
- This prevents different npm versions from generating different lock files

### 2. Create `.npmrc` Configuration File

**File**: `.npmrc` (new file)

- Set `package-lock=true` to ensure lock file is always generated
- Set `save-exact=false` (already using `^` ranges, which is fine)
- Set `legacy-peer-deps=false` to use modern peer dependency resolution
- Configure `lockfile-version=3` to match current lockfileVersion
- Add `prefer-offline=false` to ensure fresh dependency resolution
- Set `audit=false` to speed up installs (optional, can be overridden)
- Configure path normalization to reduce OS-specific differences

### 3. Create `.nvmrc` File

**File**: `.nvmrc` (new file)

- Specify Node.js version (e.g., `20.10.0` or `20` for latest 20.x)
- Enables `nvm use` for automatic version switching
- Helps ensure consistent Node.js versions across developers

### 4. Update Documentation

**Files**: [README.md](README.md), [CONTRIBUTING.md](CONTRIBUTING.md)

- Replace `npm install` with `npm ci` in installation instructions
- Add note explaining why `npm ci` is preferred for reproducible installs
- Update troubleshooting section to mention `npm ci` for dependency issues
- Add section about Node.js version requirements and using `.nvmrc`

### 5. Update `.gitignore` (if needed)

**File**: [.gitignore](.gitignore)

- Verify `package-lock.json` is NOT ignored (it should be tracked)
- Current state appears correct - lock file should be committed

## Implementation Details

### package.json Changes

```json
"engines": {
  "node": ">=20.0.0 <21.0.0",
  "npm": ">=9.0.0"
}
```



### .npmrc Configuration

Key settings to include:

- Lock file enforcement
- Consistent dependency resolution
- Path normalization settings
- Audit configuration (optional)

### .nvmrc Content

Single line with Node.js version (e.g., `20` or specific like `20.10.0`)

### Documentation Updates

- Installation sections: Change `npm install` â†’ `npm ci`
- Add explanation of `npm ci` benefits
- Add Node.js version management section
- Update troubleshooting to recommend `npm ci` for dependency issues

## Expected Outcomes

1. **Consistent Lock Files**: All developers using same Node.js/npm versions will generate identical lock files
2. **Reduced Git Noise**: No more unintended `package-lock.json` changes in PRs
3. **Better Developer Experience**: Clear version requirements and setup instructions
4. **Fewer Merge Conflicts**: Consistent lock files reduce conflicts
5. **Reproducible Builds**: `npm ci` ensures exact dependency versions from lock file

## Verification Steps

After implementation:

1. Delete `node_modules` and `package-lock.json`
2. Run `npm install` with correct Node.js version
3. Verify no git diff in `package-lock.json`
4. Test on different OS (if possible) to verify cross-platform consistency
5. Update documentation and verify all references use `npm ci`

## Notes

- The `engines` field in `package.json` is advisory by default (npm won't fail), but tools like `nvm` and CI systems respect it